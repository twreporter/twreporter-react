import React, { useEffect, useState } from 'react'
import styled from 'styled-components'
import { useParams } from 'react-router-dom'
import axios from 'axios'
// @twreporter
import { P3, P4 } from '@twreporter/react-components/lib/text/paragraph'
import {
  colorGrayscale,
  colorOpacity,
} from '@twreporter/core/lib/constants/color'
import { useStore } from '@twreporter/react-components/lib/hook'
import twreporterRedux from '@twreporter/redux'
import FetchingWrapper from '@twreporter/react-components/lib/is-fetching-wrapper'
// components
import { formattedDate } from './table/row'
import { PayMethodType } from '../../../constants/donation'
import { cardTypeDictionary } from './table/row-detail'

// lodash
import get from 'lodash/get'

const _ = {
  get,
}

const Container = styled.div`
  width: 800px;
  margin: auto;
  display: flex;
  flex-direction: column;
  padding: 24px;
  gap: 16px;
  @media print {
    * {
      -webkit-print-color-adjust: exact !important;
    }
  }
`

const Header = styled.div`
  width: 100%;
  display: flex;
  justify-content: space-between;
`

const P3Gray800 = styled(P3)`
  color: ${colorGrayscale.gray800};
`

const P4Gray600 = styled(P4)`
  color: ${colorGrayscale.gray600};
`

const ReceiptBox = styled.div`
  width: 100%;
  display: flex;
  flex-direction: column;
`
const ReceiptHeader = styled(P3Gray800)`
  width: 100%;
  height: 32px;
  border-bottom: 1px solid ${colorGrayscale.gray200};
  display: flex;
  align-items: center;
`

const ReceiptContent = styled.div`
  width: 100%;
  height: 32px;
  display: flex;
  align-items: center;
  gap: 8px;
`

const ReceiptContentHeader = styled(P3Gray800)`
  width: 120px;
`

const RecordBox = styled.div`
  width: 100%;
  display: flex;
  flex-direction: column;
`

const RecordBoxHeader = styled.div`
  width: 100%;
  height: 32px;
  gap: 16px;
  border-bottom: 1px solid ${colorGrayscale.gray200};
  display: flex;
  align-items: center;
  .date {
    width: 20%;
  }
  .order-number {
    width: 40%;
  }
  .amount {
    width: 20%;
  }
  .status {
    width: 20%;
  }
`

const RecordBoxContent = styled.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  @media print {
    * {
      break-inside: avoid;
    }
  }
`

const RecordBoxContentRow = styled.div`
  width: 100%;
  height: 32px;
  gap: 16px;
  display: flex;
  align-items: center;
  &:nth-child(even) {
    background-color: ${colorOpacity['black_0.05']};
  }
  .date {
    width: 20%;
  }
  .order-number {
    width: 40%;
  }
  .amount {
    width: 20%;
  }
  .status {
    width: 20%;
  }
`

const DotGroup = styled.div`
  display: flex;
  gap: 4px;
`

const Dot = styled.div`
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background-color: ${colorGrayscale.black};
`

const Loading = styled.div``

const LoadingMask = FetchingWrapper(Loading)

const DotGroups = () =>
  Array.from({ length: 3 }, (_, i) => (
    <DotGroup key={i}>
      <Dot />
      <Dot />
      <Dot />
      <Dot />
    </DotGroup>
  ))

const { reduxStateFields } = twreporterRedux

const statusDictionary = {
  paying: '進行中',
  paid: '已完成',
  fail: '扣款失敗',
  refunded: '已退款',
}

const DonwloadPage = () => {
  const { orderNumber } = useParams()
  const store = useStore()
  const [state] = store
  const [history, setHistory] = useState()
  const [receiptHeader, setReceiptHeader] = useState('')
  const [receiptAddress, setReceiptAddress] = useState('')
  const [receiptPayMethod, setReceiptPayMethod] = useState('')
  const [cardLastFour, setCardLastFour] = useState('')
  const [cardType, setCardType] = useState('')
  const [isLoading, setIsLoading] = useState(true)
  const jwt = _.get(state, [reduxStateFields.auth, 'accessToken'])
  const apiOrigin = _.get(state, [reduxStateFields.origins, 'api'])

  const getReceiptData = async () => {
    const { data: orderResponseData } = await axios.get(
      `${apiOrigin}/v1/periodic-donations/orders/${orderNumber}`,
      {
        timeout: 8000,
        headers: {
          Authorization: `Bearer ${jwt}`,
        },
        withCredentials: true,
      }
    )
    const {
      card_info: cardInfo,
      receipt,
      pay_method: payMethod,
    } = orderResponseData.data
    const address = `${receipt.address_state || ''}${receipt.address_city ||
      ''}${receipt.address_detail || ''}`
    setReceiptHeader(receipt.header)
    setReceiptAddress(address)
    setReceiptPayMethod(payMethod)
    setCardLastFour(cardInfo.last_four)
    setCardType(cardInfo.type)
  }
  const getPaymentHistory = async () => {
    // set limit to -1 to get all records
    const { data: historyResponseData } = await axios.get(
      `${apiOrigin}/v1/periodic-donations/orders/${orderNumber}/payments?limit=-1`,
      {
        timeout: 8000,
        headers: {
          Authorization: `Bearer ${jwt}`,
        },
        withCredentials: true,
      }
    )
    const { records } = historyResponseData
    setHistory(records)
  }
  useEffect(() => {
    getReceiptData()
    getPaymentHistory()
    setIsLoading(false)
    window.print()
  }, [])

  return (
    <LoadingMask isFetching={isLoading} showSpinner={isLoading}>
      <Container>
        <Header>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="149"
            height="16"
            viewBox="0 0 149 16"
            fill="none"
          >
            <path
              d="M9.43711 4.06832L15.0978 2.54669V13.4693L9.43711 11.9317V4.06832Z"
              fill="black"
            />
            <path d="M0 0L9.43712 4.0683V11.9317L0 16V0Z" fill="#2E2E2E" />
            <path
              d="M24.5054 11.2796H25.8036C26.4397 11.2977 27.0756 11.2381 27.6977 11.1021V12.2588C27.0755 12.1237 26.4396 12.0641 25.8036 12.0813H24.5054V14.5881C24.5015 14.7687 24.5391 14.9478 24.6152 15.1112C24.6914 15.2745 24.8039 15.4177 24.944 15.5294H22.6821C22.8226 15.418 22.9354 15.2749 23.0116 15.1115C23.0877 14.948 23.1251 14.7688 23.1207 14.5881V12.0813H21.5944C20.9584 12.0643 20.3226 12.1239 19.7003 12.2588V11.1021C20.3224 11.2379 20.9583 11.2975 21.5944 11.2796H23.1207V9.52064H21.8934C21.2573 9.5035 20.6215 9.56308 19.9993 9.69813V8.64915C20.6215 8.7842 21.2573 8.84379 21.8934 8.82664H25.3472C25.9833 8.84379 26.6192 8.7842 27.2414 8.64915V9.69813C26.6192 9.56308 25.9833 9.5035 25.3472 9.52064H24.5054V11.2796ZM21.8324 5.96487C21.1963 5.94692 20.5604 6.00651 19.9383 6.14236V5.05748C20.5605 5.19234 21.1964 5.25192 21.8324 5.23496H23.1306V3.56377H22.0685C21.4324 3.54662 20.7965 3.6062 20.1743 3.74126V2.59256C20.7963 2.72931 21.4323 2.78957 22.0685 2.77205H23.1207V1.77491C23.1248 1.59424 23.0873 1.4151 23.0111 1.25171C22.935 1.08831 22.8223 0.945161 22.6821 0.833618H24.944C24.8042 0.945475 24.6917 1.08869 24.6156 1.25201C24.5395 1.41533 24.5018 1.59432 24.5054 1.77491V2.77205H25.3315C25.967 2.78949 26.6023 2.72923 27.2237 2.59256V3.74924C26.6021 3.61428 25.9669 3.5547 25.3315 3.57175H24.5054V5.24294H25.6285C26.2655 5.25327 26.9014 5.18632 27.5226 5.04352V6.1284C26.8998 5.99878 26.2639 5.94522 25.6285 5.96885L21.8324 5.96487ZM21.7459 6.19421C22.3814 6.68127 22.9577 7.24291 23.463 7.8674L22.4461 8.5953C22.0883 7.87905 21.6557 7.20378 21.1558 6.58109L21.7459 6.19421ZM24.1927 8.15058C24.5928 7.52007 24.9496 6.8624 25.2607 6.18224L26.3995 6.80445C25.9083 7.4391 25.3496 8.01693 24.7336 8.5275L24.1927 8.15058ZM33.2777 12.3824C34.0842 13.1123 35.2053 13.6986 35.996 14.0536L34.7332 15.3698C33.9465 14.971 33.1715 14.1972 32.4693 13.3437C31.6424 14.1318 30.6876 14.7693 29.6469 15.2282V15.5294H27.8236C27.9634 15.4176 28.0757 15.2744 28.1515 15.111C28.2273 14.9476 28.2645 14.7686 28.2602 14.5881V3.61961C28.2602 2.94355 28.2602 2.03616 28.0635 1.30825C29.1695 1.55289 30.2989 1.67194 31.4308 1.66323C32.5681 1.67218 33.7028 1.55245 34.8139 1.30626C34.6583 2.00538 34.5922 2.72189 34.6172 3.43813V5.03354C34.6172 5.40647 34.389 5.58396 33.8973 5.58396C33.4056 5.58396 31.8635 5.26488 30.8821 5.03354L30.6854 4.44723C31.3856 4.49908 32.0622 4.53498 32.7722 4.53498C33.1046 4.53498 33.2286 4.42928 33.2286 4.16205V2.42504H29.6449V7.04775H33.437C33.559 6.88821 33.6829 6.72867 33.8304 6.56913C34.269 6.76856 34.7431 7.01385 35.1797 7.26114C34.8827 9.45483 34.1628 11.2796 33.3033 12.3645L33.2777 12.3824ZM29.6449 14.6938C30.5143 14.0996 31.2667 13.3462 31.8635 12.4722C31.1358 11.2636 30.768 9.57249 30.5733 7.77765H29.6449V14.6938ZM31.1004 7.77765C31.3462 9.09387 31.7849 10.4799 32.4772 11.4411C32.9689 10.4619 33.319 9.048 33.4429 7.77765H31.1004Z"
              fill="black"
            />
            <path
              d="M50.3346 11.4052H51.7901C52.4261 11.4224 53.062 11.3628 53.6842 11.2277V12.3824C53.0617 12.2491 52.4261 12.1895 51.7901 12.2049H50.3346V14.8194C50.3346 15.2821 50.0376 15.5473 49.4062 15.5473C48.704 15.5473 46.8807 15.2821 45.7222 15.0328L45.496 14.3587C46.4244 14.4305 47.4236 14.4824 48.2497 14.4824C48.643 14.4824 48.7945 14.3228 48.7945 14.0217V12.2049H42.8112C43.7826 12.6054 44.7262 13.0717 45.6357 13.6009L44.4949 14.7217C43.617 13.7856 42.6476 12.9424 41.6016 12.2049H40.0281C39.3921 12.1895 38.7564 12.2491 38.134 12.3824V11.2277C38.7562 11.3628 39.392 11.4224 40.0281 11.4052H48.7965V10.2486C45.6494 10.2306 43.3423 10.107 40.8345 8.7369C40.2265 9.57486 39.4128 10.2369 38.4742 10.6574L37.5793 9.44886C38.5982 9.23547 39.5462 8.89844 40.1579 8.43577V5.91103C39.4065 5.8911 38.655 5.94452 37.9137 6.07057V5.03953C38.5481 5.17515 39.1949 5.242 39.8432 5.23896C40.4673 5.2484 41.0905 5.18888 41.7019 5.06147C41.5692 5.75265 41.5034 6.4553 41.5052 7.15944V8.54545C43.2754 9.31125 45.4862 9.38105 47.9586 9.38105C50.3188 9.38105 52.6929 9.27535 53.9733 9.06197L53.2357 10.1289C52.3073 10.1827 51.2905 10.2166 50.3247 10.2346L50.3346 11.4052ZM40.4274 3.91876C39.7303 3.01537 38.9556 2.17648 38.1123 1.41196L38.726 0.825648C39.7732 1.38799 40.7616 2.05614 41.6763 2.81991L40.4274 3.91876ZM43.8812 2.92162C43.2452 2.9063 42.6096 2.96586 41.9871 3.09911V1.99429C42.6092 2.13014 43.2451 2.18973 43.8812 2.17178H45.3544C44.8115 1.72706 44.1979 1.30228 43.7416 0.975218L44.1625 0.442749C45.0555 0.74559 45.9188 1.13216 46.7411 1.59743L46.0389 2.1658H48.529C48.8102 1.63333 49.0541 1.08091 49.3 0.512548L51.5796 1.15271C50.8704 1.53572 50.1387 1.87406 49.3885 2.1658H51.6504C52.2865 2.18394 52.9225 2.12434 53.5445 1.98831V3.09113C52.9221 2.95779 52.2864 2.89823 51.6504 2.91364H48.7394C48.2306 3.21544 47.7219 3.49996 47.2131 3.76719H52.2641V8.47167H43.4682V3.77716H46.6152C46.7037 3.49198 46.7902 3.2088 46.861 2.92362L43.8812 2.92162ZM50.844 5.16118V4.36348H44.8804V5.16118H50.844ZM44.8804 5.6438V6.49734H50.844V5.6438H44.8804ZM44.8804 7.88336H50.844V6.97995H44.8804V7.88336Z"
              fill="black"
            />
            <path
              d="M69.8756 5.83921C70.511 5.85625 71.1462 5.79667 71.7677 5.66172V6.81839C71.1461 6.68347 70.511 6.62323 69.8756 6.63891H65.6664C64.6182 7.33041 63.5079 7.92001 62.3503 8.39985H69.3996V14.5701C69.3932 14.7537 69.4296 14.9362 69.5058 15.1029C69.582 15.2696 69.6959 15.4157 69.8382 15.5293H67.5074C67.6479 15.4262 67.7613 15.2898 67.8378 15.1319C67.9142 14.9741 67.9514 14.7997 67.9461 14.624H60.8082C60.8025 14.7998 60.8396 14.9743 60.916 15.1322C60.9925 15.2901 61.1061 15.4265 61.2468 15.5293H58.9141C59.0561 15.4153 59.1697 15.2692 59.2459 15.1026C59.3221 14.936 59.3587 14.7536 59.3527 14.5701V9.52062C58.1186 9.94445 56.8592 10.2888 55.5822 10.5517L55.1888 9.98329C58.2395 9.25339 60.9754 8.20441 63.5363 6.63891H57.5629C56.9274 6.62323 56.2923 6.68347 55.6707 6.81839V5.66172C56.2923 5.79667 56.9274 5.85625 57.5629 5.83921H62.1752V3.74124H59.5455C58.9095 3.72583 58.2738 3.78539 57.6514 3.91873V2.76405C58.2736 2.8991 58.9094 2.95869 59.5455 2.94154H62.1752V1.76692C62.1794 1.58644 62.1421 1.40746 62.0663 1.2441C61.9905 1.08074 61.8783 0.937475 61.7386 0.825623H64.0988C63.9589 0.937479 63.8465 1.08069 63.7704 1.24401C63.6943 1.40733 63.6566 1.58632 63.6602 1.76692V2.94154H67.8575C68.3906 2.30421 68.8827 1.63275 69.3307 0.931319L70.7508 1.67917C69.5795 3.24559 68.2054 4.64486 66.6656 5.83921H69.8756ZM67.9461 11.0662V9.19955H60.7905V11.0662H67.9461ZM60.8082 13.8223H67.9461V11.7961H60.8082V13.8223ZM63.6661 3.74124V5.83921H64.7538C65.6234 5.22483 66.4288 4.52185 67.1573 3.74124H63.6661Z"
              fill="black"
            />
            <path
              d="M80.2312 5.69161C80.1261 5.57882 80.0023 5.48567 79.8654 5.4164C79.5188 5.24944 79.1375 5.17007 78.7541 5.18507H78.1109V8.04884C78.1109 10.9066 78.1522 10.9465 78.3666 11.3394L78.4571 11.5049C78.4571 11.5049 78.1817 11.487 77.5405 11.487C76.8993 11.487 76.6023 11.5049 76.6023 11.5049L76.6928 11.3394C76.8895 10.9664 76.9485 10.8966 76.9485 7.94912V5.18507H76.3152C75.9314 5.17131 75.5501 5.25206 75.2039 5.42039C75.0668 5.48944 74.9429 5.58262 74.838 5.6956C74.8595 5.48026 74.8694 5.26389 74.8675 5.04747C74.8675 4.67454 74.8675 4.50702 74.8675 4.50702H80.2312C80.2312 4.50702 80.2214 4.67454 80.2214 5.04747C80.2131 5.2622 80.2164 5.47724 80.2312 5.69161V5.69161Z"
              fill="black"
            />
            <path
              d="M86.6138 11.487C85.9608 11.487 85.6756 11.5049 85.6756 11.5049L85.768 11.3394C85.9647 10.9764 86.0217 10.8867 86.0217 8.29416H82.8216C82.8216 10.8867 82.8609 10.9565 83.0753 11.3394L83.1678 11.5049C83.1678 11.5049 82.8924 11.487 82.2492 11.487C81.6061 11.487 81.311 11.5049 81.311 11.5049L81.4035 11.3394C81.6002 10.9665 81.6592 10.8967 81.6592 7.94915C81.6592 5.09136 81.6179 5.05148 81.4035 4.65861L81.311 4.49109C81.311 4.49109 81.5766 4.51103 82.2394 4.51103C82.9022 4.51103 83.1678 4.49109 83.1678 4.49109L83.0753 4.65861C82.8786 5.01159 82.8216 5.10133 82.8216 7.48648H86.0217C86.0217 5.12128 85.9706 5.03154 85.768 4.65861L85.6756 4.49109C85.6756 4.49109 85.9411 4.51103 86.6039 4.51103C87.2668 4.51103 87.5323 4.49109 87.5323 4.49109L87.4399 4.65861C87.2432 5.03154 87.1842 5.10133 87.1842 8.04886C87.1842 10.9066 87.2255 10.9465 87.4399 11.3394L87.5323 11.5049C87.5323 11.5049 87.2668 11.487 86.6138 11.487Z"
              fill="black"
            />
            <path
              d="M93.6395 11.1918L93.6237 11.4969H90.0243C89.4736 11.4969 89.2376 11.4969 89.2376 11.4969L89.33 11.3314C89.5267 10.9585 89.5838 10.8887 89.5838 7.94115C89.5838 5.08337 89.5444 5.04348 89.33 4.65061L89.2376 4.48309C89.2376 4.48309 89.4618 4.48309 90.0125 4.48309H93.5195C93.5195 4.48309 93.5097 4.65061 93.5097 5.02354C93.5074 5.23671 93.5179 5.44983 93.5411 5.6617C93.4317 5.55583 93.3079 5.4665 93.1733 5.39647C92.8216 5.23594 92.4374 5.16214 92.0522 5.18109H90.7462V7.646H91.8063C92.1898 7.67246 92.5741 7.609 92.9294 7.46053C93.0627 7.39341 93.1858 7.30746 93.2953 7.20527C93.2953 7.20527 93.2658 7.48845 93.2658 8.00297C93.2658 8.5175 93.2953 8.77077 93.2953 8.78872C93.1876 8.68167 93.0642 8.59219 92.9294 8.52348C92.5741 8.37501 92.1898 8.31155 91.8063 8.33801H90.7462V10.7989H91.9499C93.2146 10.7989 93.3779 10.5138 93.7555 9.98328C93.7516 9.98328 93.7004 10.3462 93.6395 11.1918Z"
              fill="black"
            />
            <path
              d="M102.927 11.5249C102.203 11.5249 101.928 11.2317 101.438 10.4839L100.744 9.42293C100.142 8.50956 100.03 8.31412 99.5205 8.31412C99.4626 8.31379 99.4048 8.31712 99.3474 8.32409C99.3474 10.799 99.3887 10.9366 99.6031 11.3155L99.6935 11.483C99.6935 11.483 99.43 11.4631 98.7868 11.4631C98.1436 11.4631 97.8683 11.483 97.8683 11.483L97.9607 11.3155C98.1574 10.9525 98.2164 10.8728 98.2164 7.92524C98.2164 5.06746 98.1751 5.02757 97.9607 4.6347L97.8683 4.46918C97.8683 4.46918 98.1849 4.48713 98.6334 4.48713C98.9402 4.48713 99.5008 4.46918 99.8568 4.46918C101.122 4.46918 102.671 4.55692 102.671 6.24607C102.671 7.15944 102.101 8.12068 100.459 8.1127C101.304 8.22039 101.621 8.64118 102.142 9.47678L102.642 10.3124C102.978 10.8708 103.232 11.2437 103.641 11.4212C103.641 11.4272 103.488 11.5249 102.927 11.5249ZM99.8273 5.1233C99.5618 5.1233 99.3474 5.14125 99.3474 5.14125V7.67596C99.3474 7.67596 99.5303 7.67596 99.9079 7.67596C100.042 7.67596 100.337 7.65601 100.51 7.63607C101.019 7.54832 101.438 7.14548 101.438 6.36971C101.438 5.25891 100.744 5.1233 99.8273 5.1233V5.1233Z"
              fill="black"
            />
            <path
              d="M108.993 11.1679L108.973 11.473H105.374C104.823 11.473 104.587 11.483 104.587 11.483L104.678 11.3155C104.874 10.9426 104.933 10.8728 104.933 7.92524C104.933 5.06746 104.892 5.02757 104.678 4.6347L104.587 4.46918C104.587 4.46918 104.811 4.46918 105.36 4.46918H108.869C108.869 4.46918 108.869 4.6367 108.869 5.00962C108.867 5.22274 108.877 5.43581 108.899 5.64779C108.79 5.5405 108.666 5.45101 108.531 5.38255C108.179 5.22181 107.795 5.14799 107.41 5.16717H106.106V7.6261H107.166C107.549 7.65261 107.932 7.58914 108.287 7.44063C108.419 7.37141 108.54 7.28344 108.647 7.17939C108.647 7.17939 108.615 7.46257 108.615 7.97709C108.615 8.49161 108.647 8.74289 108.647 8.76283C108.539 8.65541 108.415 8.56591 108.279 8.4976C107.925 8.34827 107.541 8.28411 107.158 8.31013H106.098V10.779H107.299C108.564 10.779 108.727 10.4939 109.105 9.96338C109.105 9.97136 109.054 10.3283 108.993 11.1679Z"
              fill="black"
            />
            <path
              d="M112.826 8.72691C112.591 8.72676 112.356 8.7101 112.122 8.67706C112.122 10.7491 112.164 10.9266 112.388 11.3195L112.48 11.487C112.48 11.487 112.215 11.467 111.552 11.467C110.889 11.467 110.624 11.487 110.624 11.487L110.716 11.3195C110.913 10.9565 110.97 10.8767 110.97 7.92921C110.97 5.07142 110.93 5.03154 110.716 4.63867L110.624 4.47314C110.624 4.47314 110.909 4.49109 111.379 4.49109C111.806 4.49109 112.362 4.47314 112.663 4.47314C113.662 4.47314 115.497 4.54095 115.497 6.53522C115.497 8.42179 113.957 8.72691 112.826 8.72691ZM112.653 5.12328C112.347 5.12328 112.122 5.14122 112.122 5.14122V8.04886C112.318 8.07535 112.515 8.08535 112.712 8.07878C114.189 8.07878 114.252 7.08164 114.252 6.52724C114.254 5.27883 113.336 5.12328 112.653 5.12328V5.12328Z"
              fill="black"
            />
            <path
              d="M119.943 11.5947C117.832 11.5947 116.68 10.2386 116.68 8.13661C116.68 7.08563 116.984 4.40533 119.952 4.40533C122.073 4.40533 123.225 5.76144 123.225 7.8614C123.225 8.91238 122.919 11.5947 119.943 11.5947ZM119.943 5.12327C118.861 5.12327 117.954 5.86913 117.954 8.02892C117.954 10.1887 118.841 10.8767 119.952 10.8767C121.032 10.8767 121.947 10.1309 121.947 7.97707C121.947 5.82326 121.054 5.12327 119.943 5.12327V5.12327Z"
              fill="black"
            />
            <path
              d="M129.649 11.5249C128.923 11.5249 128.648 11.2317 128.16 10.4839L127.466 9.42293C126.864 8.50956 126.752 8.31412 126.243 8.31412C126.185 8.31379 126.127 8.31712 126.069 8.32409C126.069 10.799 126.111 10.9366 126.325 11.3155L126.416 11.483C126.416 11.483 126.15 11.4631 125.509 11.4631C124.868 11.4631 124.59 11.483 124.59 11.483L124.683 11.3155C124.88 10.9525 124.939 10.8728 124.939 7.92524C124.939 5.06746 124.897 5.02757 124.683 4.6347L124.59 4.46918C124.59 4.46918 124.907 4.48713 125.355 4.48713C125.662 4.48713 126.223 4.46918 126.579 4.46918C127.844 4.46918 129.394 4.55692 129.394 6.24607C129.394 7.15944 128.823 8.12068 127.181 8.1127C128.027 8.22039 128.343 8.64118 128.862 9.47678L129.362 10.3124C129.698 10.8708 129.952 11.2437 130.361 11.4212C130.361 11.4272 130.208 11.5249 129.649 11.5249ZM126.549 5.1233C126.284 5.1233 126.069 5.14125 126.069 5.14125V7.67596C126.069 7.67596 126.252 7.67596 126.63 7.67596C126.762 7.67596 127.059 7.65601 127.232 7.63607C127.741 7.54832 128.16 7.14548 128.16 6.36971C128.16 5.25891 127.466 5.1233 126.549 5.1233Z"
              fill="black"
            />
            <path
              d="M136.093 5.67168C135.986 5.55997 135.862 5.46697 135.725 5.39647C135.379 5.2279 134.997 5.14715 134.614 5.16114H133.97V8.0289C133.97 10.8867 134.012 10.9266 134.226 11.3194L134.319 11.487C134.319 11.487 134.043 11.467 133.4 11.467C132.757 11.467 132.462 11.487 132.462 11.487L132.554 11.3194C132.751 10.9465 132.808 10.8767 132.808 7.92919V5.16114H132.175C131.791 5.14674 131.409 5.22752 131.063 5.39647C130.926 5.4652 130.801 5.55841 130.696 5.67168C130.719 5.45644 130.729 5.24002 130.727 5.02354C130.727 4.65061 130.715 4.48309 130.715 4.48309H136.079C136.079 4.48309 136.079 4.65061 136.079 5.02354C136.071 5.23967 136.076 5.45609 136.093 5.67168V5.67168Z"
              fill="black"
            />
            <path
              d="M141.712 11.1679L141.692 11.473H138.093C137.542 11.473 137.306 11.483 137.306 11.483L137.399 11.3155C137.595 10.9426 137.652 10.8728 137.652 7.92524C137.652 5.06746 137.611 5.02757 137.399 4.6347L137.306 4.46918C137.306 4.46918 137.531 4.46918 138.081 4.46918H141.588C141.588 4.46918 141.588 4.6367 141.588 5.00962C141.586 5.22274 141.596 5.43581 141.618 5.64779C141.51 5.54074 141.387 5.45127 141.252 5.38255C140.9 5.22225 140.516 5.14845 140.131 5.16717H138.825V7.6261H139.885C140.268 7.65283 140.651 7.58935 141.006 7.44063C141.138 7.37207 141.259 7.28403 141.366 7.17939C141.366 7.17939 141.334 7.46257 141.334 7.97709C141.334 8.49161 141.366 8.74289 141.366 8.76283C141.258 8.65473 141.134 8.56514 140.998 8.4976C140.644 8.34806 140.26 8.28389 139.877 8.31013H138.817V10.779H140.021C141.285 10.779 141.449 10.4939 141.824 9.96338C141.824 9.97136 141.773 10.3283 141.712 11.1679Z"
              fill="black"
            />
            <path
              d="M148.266 11.5249C147.54 11.5249 147.267 11.2317 146.777 10.4839L146.083 9.42293C145.481 8.50956 145.369 8.31412 144.859 8.31412C144.801 8.31379 144.743 8.31712 144.686 8.32409C144.686 10.799 144.727 10.9366 144.942 11.3155L145.032 11.483C145.032 11.483 144.767 11.4631 144.125 11.4631C143.484 11.4631 143.207 11.483 143.207 11.483L143.299 11.3155C143.496 10.9525 143.555 10.8728 143.555 7.92524C143.555 5.06746 143.514 5.02757 143.299 4.6347L143.207 4.46918C143.207 4.46918 143.524 4.48713 143.972 4.48713C144.279 4.48713 144.839 4.46918 145.195 4.46918C146.46 4.46918 148.01 4.55692 148.01 6.24607C148.01 7.15944 147.44 8.12068 145.797 8.1127C146.643 8.22039 146.96 8.64118 147.479 9.47678L147.979 10.3124C148.317 10.8708 148.569 11.2437 148.978 11.4212C148.978 11.4272 148.826 11.5249 148.266 11.5249ZM145.166 5.1233C144.9 5.1233 144.686 5.14125 144.686 5.14125V7.67596C144.686 7.67596 144.869 7.67596 145.247 7.67596C145.38 7.67596 145.675 7.65601 145.848 7.63607C146.358 7.54832 146.777 7.14548 146.777 6.36971C146.777 5.25891 146.083 5.1233 145.166 5.1233V5.1233Z"
              fill="black"
            />
          </svg>
          <P4Gray600 text={`贊助編號: ${orderNumber}`} />
        </Header>
        <ReceiptBox>
          <ReceiptHeader weight={P3.Weight.BOLD} text="收據資料" />
          <ReceiptContent>
            <ReceiptContentHeader text="收據抬頭" />
            <P3Gray800 text={receiptHeader} />
          </ReceiptContent>
          <ReceiptContent>
            <ReceiptContentHeader text="收據寄送地址" />
            <P3Gray800 text={receiptAddress} />
          </ReceiptContent>
          <ReceiptContent>
            <ReceiptContentHeader text="付款方式" />
            {receiptPayMethod === PayMethodType.LINE ? (
              <P3Gray800 text="LINE Pay" />
            ) : (
              <>
                <P3Gray800 text={cardTypeDictionary[cardType]} />
                <DotGroups />
                <P3Gray800 text={cardLastFour} />
              </>
            )}
          </ReceiptContent>
        </ReceiptBox>
        <RecordBox>
          <RecordBoxHeader>
            <P3Gray800
              className="date"
              weight={P3.Weight.BOLD}
              text="扣款日期"
            />
            <P3Gray800
              className="order-number"
              weight={P3.Weight.BOLD}
              text="扣款編號"
            />
            <P3Gray800 className="amount" weight={P3.Weight.BOLD} text="金額" />
            <P3Gray800 className="status" weight={P3.Weight.BOLD} text="狀態" />
          </RecordBoxHeader>
          <RecordBoxContent>
            {history &&
              history.map((record, idx) => (
                <RecordBoxContentRow key={idx}>
                  <P3Gray800
                    className="date"
                    text={formattedDate(new Date(record.created_at))}
                  />
                  <P3Gray800
                    className="order-number"
                    text={record.order_number}
                  />
                  <P3Gray800
                    className="amount"
                    text={`${record.amount.toLocaleString('en-US')}元`}
                  />
                  <P3Gray800
                    className="status"
                    text={statusDictionary[record.status]}
                  />
                </RecordBoxContentRow>
              ))}
          </RecordBoxContent>
        </RecordBox>
      </Container>
    </LoadingMask>
  )
}

export default DonwloadPage
